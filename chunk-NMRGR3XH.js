import{f as B}from"./chunk-FMUD7W2X.js";import{Aa as m,Jb as c,Jc as v,Oa as l,Qa as E,Sa as p,Ta as I,Ua as T,V as u,Va as r,Wa as i,Wb as L,Xa as a,Ya as F,Za as h,_a as f,aa as C,ba as x,e as _,eb as o,fb as b,gb as g,ua as s,va as y}from"./chunk-3S6KW6BY.js";var N=(n,t)=>t.id;function A(n,t){n&1&&(r(0,"th",6),o(1,"ACCIONES"),i())}function R(n,t){if(n&1){let e=F();r(0,"td")(1,"div",7),a(2,"div",8),r(3,"div",9)(4,"button",10),a(5,"i",11),i()(),r(6,"div",9)(7,"button",12),h("click",function(){C(e);let S=f().$implicit,V=f();return x(V.deleteProductById(S.id))}),a(8,"i",13),i()(),a(9,"div",8),i()()}}function k(n,t){if(n&1&&(r(0,"tr",5)(1,"td"),o(2),i(),r(3,"td"),o(4),i(),r(5,"td"),o(6),i(),r(7,"td"),o(8),i(),r(9,"td"),o(10),i(),l(11,R,10,0,"td"),i()),n&2){let e=t.$implicit,d=f();s(2),b(e.initials),s(2),b(e.name),s(2),b(e.availabilityInDeposit),s(2),g("$",e.priceByUnit,""),s(2),g("$",e.priceByKg,""),s(),p(d.isAdmin?11:-1)}}var P=class n{products=[];productService=u(v);isAdmin=!0;limit=10;lastVisible;searchQuery="";isSearching=!1;isLoading=!1;ngOnInit(){this.loadProducts()}loadProducts(){this.isLoading=!0,this.productService.getProducts(this.limit,this.lastVisible).then(t=>{this.products=[...this.products,...t],this.lastVisible=t[t.length-1],this.isLoading=!1})}deleteProductById(t){this.isLoading=!0,confirm("\xBFEst\xE1s seguro de eliminar este producto?")&&this.productService.deleteProductById(t).then(()=>{this.products=this.products.filter(e=>e.id!==t)}),this.isLoading=!1}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=m({type:n,selectors:[["app-products-table"]],inputs:{products:"products"},decls:22,vars:1,consts:[[1,"card","mt-5","shadow","m-auto"],[1,"card-header","text-center"],[1,"h5","my-1"],[1,"card-body"],[1,"table","table-striped"],[1,"text-center"],["scope","col"],[1,"row","justify-content-center"],[1,"col-1"],[1,"col-2"],[1,"btn","btn-info","btn-sm","opacity-75"],[1,"bi","bi-pencil-square"],[1,"btn","btn-danger","btn-sm","opacity-75",3,"click"],[1,"bi","bi-trash3"]],template:function(e,d){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),o(3,"LISTA DE PRODUCTOS"),i()(),r(4,"div",3)(5,"table",4)(6,"thead")(7,"tr",5)(8,"th",6),o(9,"INICIALES"),i(),r(10,"th",6),o(11,"NOMBRE"),i(),r(12,"th",6),o(13,"STOCK"),i(),r(14,"th",6),o(15,"PRECIO POR UNIDAD"),i(),r(16,"th",6),o(17,"PRECIO POR KG"),i(),l(18,A,2,0,"th",6),i()(),r(19,"tbody"),I(20,k,12,6,"tr",5,N),i()()()()),e&2&&(s(18),p(d.isAdmin?18:-1),s(2),T(d.products))},encapsulation:2})};function q(n,t){n&1&&(r(0,"span",6)(1,"div",8)(2,"span",9),o(3,"Cargando..."),i()()())}var D=class n{constructor(t){this.fb=t;this.productForm=this.fb.group({name:["",c.required],initials:["",c.required],quantity:[0,c.required],price_by_unit:[0,c.required],price_by_kg:[0,c.required]})}productService=u(v);products=[];searchQuery="";isAdmin=!0;lastVisible;limit=10;isSearching=!1;isLoading=!1;productForm;showProductForm=!1;loadProducts(){this.isLoading=!0,this.productService.getProducts(this.limit,this.lastVisible).then(t=>{this.products=[...this.products,...t],this.lastVisible=t[t.length-1],this.isLoading=!1})}searchProducts(t){return _(this,null,function*(){if(!t){this.isSearching=!1,this.products=[],this.lastVisible=null,yield this.loadProducts();return}try{this.isSearching=!0;let e=yield this.productService.getProductsByName(t);this.products=e,this.isSearching=!1}catch(e){console.error("Error al buscar productos:",e),this.isSearching=!1}})}editProduct(t){this.productService.updateProduct(t.id,t)}deleteProduct(t){confirm("\xBFEst\xE1s seguro de eliminar este producto?")&&this.productService.deleteProductById(t).then(()=>{this.products=this.products.filter(e=>e.id!==t)})}openProductForm(){this.showProductForm=!0}closeProductForm(){this.showProductForm=!1}static \u0275fac=function(e){return new(e||n)(y(L))};static \u0275cmp=m({type:n,selectors:[["app-products"]],decls:9,vars:2,consts:[[1,"container","mt-4"],[1,"row"],[1,"col-12"],["type","button","routerLink","/home/create-product",1,"btn","btn-primary","mb-3"],[1,"input-group","mb-3"],["type","text","placeholder","Buscar productos por nombre",1,"form-control",3,"input"],[1,"input-group-text"],[3,"products"],["role","status",1,"spinner-border","spinner-border-sm"],[1,"visually-hidden"]],template:function(e,d){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),o(4," Crear Producto "),i(),r(5,"div",4)(6,"input",5),h("input",function(){return d.searchProducts("")}),i(),l(7,q,4,0,"span",6),i(),a(8,"app-products-table",7),i()()()),e&2&&(s(7),p(d.isSearching?7:-1),s(),E("products",d.products))},dependencies:[B,P],encapsulation:2})};export{D as ProductsComponent};
