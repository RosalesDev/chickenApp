import{$a as x,Ca as y,Fb as S,Jb as F,Kb as P,Lb as m,Lc as U,Mb as T,Nb as k,Qa as u,Qb as w,Sa as h,Sb as N,Tb as q,Ua as c,Ub as I,Vb as V,Wb as $,X as C,Xa as n,Ya as r,Yb as D,Za as p,_b as O,ab as _,g as v,gb as l,ib as E,wa as d}from"./chunk-5CSTD54V.js";function L(o,e){o&1&&(n(0,"span",12),l(1,"Se requiere el c\xF3digo de barras."),r())}function j(o,e){o&1&&(n(0,"span",12),l(1,"Le faltan digitos al c\xF3dico de barras"),r())}function M(o,e){if(o&1&&(n(0,"div",5),p(1,"input",11),u(2,L,2,0,"span",12)(3,j,2,0,"span",12),n(4,"label",13),l(5,"Escan\xE9a el C\xF3digo de barras"),r()()),o&2){let t,i=_();d(2),c(i.form.get("barcode").hasError("required")?2:-1),d(),c(((t=i.form.get("barcode"))==null||t.value==null?null:t.value.toString().length)<6&&i.form.get("barcode").dirty?3:-1)}}function A(o,e){o&1&&(n(0,"div",16),l(1," El c\xF3digo PLU es debe tener 5 d\xEDgitos. "),r())}function R(o,e){if(o&1&&(n(0,"div",5),p(1,"input",14),n(2,"label",15),l(3,"C\xF3digo PLU"),r(),u(4,A,2,0,"div",16),r()),o&2){let t,i=_();d(4),c((t=i.form.get("pluCode"))!=null&&t.hasError("pattern")&&((t=i.form.get("pluCode"))!=null&&t.touched)?4:-1)}}function B(o,e){o&1&&(n(0,"span",12),l(1,"El nombre es obligatorio."),r())}function W(o,e){o&1&&(n(0,"span",12),l(1,"Campo obligatorio."),r())}function K(o,e){o&1&&(n(0,"span",12),l(1,"El stock es obligatorio"),r())}function z(o,e){o&1&&(n(0,"span",12),l(1,"Este dato es obligatorio."),r())}function H(o,e){o&1&&(n(0,"span",12),l(1,"Este dato es obligatorio."),r())}function J(o,e){if(o&1&&(n(0,"div",20)(1,"div",5),p(2,"input",30),n(3,"label",31),l(4,"Precio por Kg"),r(),u(5,H,2,0,"span",12),r()()),o&2){let t,i=_(2);d(5),c(i.form.get("price_by_kg").hasError("required")&&((t=i.form.get("price_by_kg"))!=null&&t.touched||(t=i.form.get("price_by_kg"))!=null&&t.dirty)?5:-1)}}function Q(o,e){if(o&1&&(n(0,"div",5),p(1,"input",17),n(2,"label",18),l(3,"Nombre"),r(),u(4,B,2,0,"span",12),r(),n(5,"div",19)(6,"div",20)(7,"div",5),p(8,"input",21),n(9,"label",22),l(10,"Iniciales"),r(),u(11,W,2,0,"span",12),r()(),n(12,"div",20)(13,"div",5),p(14,"input",23),n(15,"label",24),l(16,"Stock"),r(),u(17,K,2,0,"span",12),r()()(),p(18,"hr"),n(19,"div",5)(20,"div",25)(21,"label",26),l(22,"Producto pesable"),r(),p(23,"input",27),r()(),n(24,"div",5)(25,"div",19)(26,"div",20)(27,"div",5),p(28,"input",28),n(29,"label",29),l(30,"Precio por Unidad"),r(),u(31,z,2,0,"span",12),r()(),u(32,J,6,1,"div",20),r()()),o&2){let t,i,f,g,s,a=_();d(4),c(a.form.get("name").hasError("required")&&((t=a.form.get("name"))!=null&&t.touched||(t=a.form.get("name"))!=null&&t.dirty)?4:-1),d(7),c(a.form.get("initials").hasError("required")&&((i=a.form.get("initials"))!=null&&i.touched||(i=a.form.get("initials"))!=null&&i.dirty)?11:-1),d(6),c(a.form.get("availability_in_deposit").hasError("required")&&((f=a.form.get("availability_in_deposit"))!=null&&f.touched||(f=a.form.get("availability_in_deposit"))!=null&&f.dirty)?17:-1),d(14),c(a.form.get("price_by_unit").hasError("required")&&((g=a.form.get("price_by_unit"))!=null&&g.touched||(g=a.form.get("price_by_unit"))!=null&&g.dirty)?31:-1),d(),c((s=a.form.get("is_weighed"))!=null&&s.value?32:-1)}}var G=class o{showProductForm=!1;productService=C(U);products=[];fb=C(D);form;constructor(){console.log("Se ejecuta el constructor"),this.form=this.fb.group({codeType:["barcode",[m.required]],barcode:["",[m.required,m.minLength(6),m.pattern(/^[0-9]/)]],pluCode:["",[m.required,m.pattern(/^[0-9]{5}$/)]],initials:["",[m.required]],is_weighed:[!1,[m.required]],name:["",[m.required]],availability_in_deposit:["",[m.required,m.pattern(/^(?:0|[1-9]\d*)(?:[.,]\d+)?$/)]],price_by_unit:["",[m.required,m.pattern(/^(?:0|[1-9]\d*)(?:[.,]\d+)?$/)]],price_by_kg:["",[m.required,m.pattern(/^(?:0|[1-9]\d*)(?:[.,]\d+)?$/)]]})}ngOnInit(){console.log("Se ejecuta el ngOnInit"),this.form.get("name")?.valueChanges.subscribe(e=>{this.generarIniciales(e)}),this.form.get("price_by_kg")?.disable(),this.form.get("is_weighed")?.valueChanges.subscribe(e=>{e?this.form.get("price_by_kg")?.enable():(this.form.get("price_by_kg")?.disable(),this.form.get("price_by_kg")?.reset())}),this.form.get("pluCode")?.valueChanges.subscribe(e=>{!/^\d+$/.test(e)&&e?.length>0&&this.form.get("pluCode")?.setValue(e.slice(0,e.length-1)),e?.length>5&&this.form.get("pluCode")?.setValue(e.slice(0,5))}),this.form.get("barcode")?.valueChanges.subscribe(e=>{!/^\d+$/.test(e)&&e?.length>0&&this.form.get("barcode")?.setValue(e.slice(0,e.length-1))}),this.form.get("availability_in_deposit")?.valueChanges.subscribe(e=>{!/^(?:0|[1-9]\d*)(?:[.,]\d*)?$/.test(e)&&e?.length>0&&this.form.get("availability_in_deposit")?.setValue(e.slice(0,e.length-1))}),this.form.get("price_by_unit")?.valueChanges.subscribe(e=>{!/^(?:0|[1-9]\d*)(?:[.,]\d*)?$/.test(e)&&e?.length>0&&this.form.get("price_by_unit")?.setValue(e.slice(0,e?.length-1))}),this.form.get("price_by_kg")?.valueChanges.subscribe(e=>{!/^(?:0|[1-9]\d*)(?:[.,]\d*)?$/.test(e)&&e?.length>0&&this.form.get("price_by_kg")?.setValue(e.slice(0,e?.length-1))}),this.form.get("pluCode")?.disable(),this.form.get("codeType")?.valueChanges.subscribe(e=>{this.form.get("name")?.reset(),this.form.get("availability_in_deposit")?.reset(),this.form.get("price_by_unit")?.reset(),this.form.get("price_by_kg")?.reset(),e==="pluCode"?(this.form.get("barcode")?.reset(),this.form.get("barcode")?.disable(),this.form.get("pluCode")?.disabled&&this.form.get("pluCode")?.enable()):(this.form.get("pluCode")?.reset(),this.form.get("pluCode")?.disable(),this.form.get("barcode")?.disabled&&this.form.get("barcode")?.enable())})}generarIniciales(e){if(!e){this.form.patchValue({initials:""});return}let t=e.split(/\s+/).map(i=>i[0]?.toUpperCase()||"").join("");this.form.patchValue({initials:t})}logInvalidFields(){Object.keys(this.form.controls).forEach(e=>{let t=this.form.get(e);t?.invalid&&console.log(`El campo "${e}" es inv\xE1lido. Errores:`,t.errors)})}createProduct(){return v(this,null,function*(){if(this.form.invalid){this.logInvalidFields(),alert("Formulario inv\xE1lido");return}yield this.productService.saveProduct(this.productService.mapProductFormToProduct(this.form)),this.closeProductForm})}closeProductForm(){this.showProductForm=!1}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=y({type:o,selectors:[["app-create-product-form"]],inputs:{showProductForm:"showProductForm"},decls:19,vars:6,consts:[[1,"card","mt-5","shadow","w-50","m-auto"],[1,"card-header","text-center","fs-5","fw-bold"],[1,"card-body"],[1,"needs-validation",3,"ngSubmit","formGroup"],[1,"container"],[1,"form-floating","mb-3"],["id","codeType","formControlName","codeType",1,"form-select"],["value","barcode"],["value","pluCode"],["for","codeType"],["type","submit",1,"btn","btn-primary","w-100",3,"disabled"],["autofocus","","type","text","id","barcode","autocomplete","off","placeholder","Escan\xE9a el C\xF3digo de barras","formControlName","barcode",1,"form-control"],[1,"alert-danger"],["for","barcode"],["id","plu_code","type","text","autofocus","","autocomplete","off","placeholder","Ingresa el C\xF3digo PLU","formControlName","pluCode",1,"form-control"],["for","plu_code"],[1,"text-danger","mt-1"],["type","text","id","name","autocomplete","off","placeholder","Nombre del producto","formControlName","name",1,"form-control","text-uppercase"],["for","name"],[1,"row"],[1,"col-6"],["type","text","id","initials","autocomplete","off","placeholder","Iniciales","formControlName","initials",1,"form-control"],["for","initials"],["type","text","autocomplete","off","id","availability_in_deposit","formControlName","availability_in_deposit",1,"form-control"],["for","availability_in_deposit",1,"form-label"],[1,"d-flex","form-switch","ps-0"],["for","flexSwitchIsWighed",1,"form-check-label"],["type","checkbox","role","switch","id","flexSwitchIsWighed","formControlName","is_weighed",1,"form-check-input","ms-3"],["type","currency","autocomplete","off","id","price_by_unit","formControlName","price_by_unit",1,"form-control"],["for","price_by_unit",1,"form-label"],["type","currency","autocomplete","off","id","price_by_kg","formControlName","price_by_kg",1,"form-control"],["for","price_by_kg",1,"form-label"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"div",1),l(2,"CREAR PRODUCTO"),r(),n(3,"div",2)(4,"form",3),x("ngSubmit",function(){return i.createProduct()}),n(5,"div",4)(6,"div",5)(7,"select",6)(8,"option",7),l(9,"C\xF3digo de Barras"),r(),n(10,"option",8),l(11,"C\xF3digo PLU"),r()(),n(12,"label",9),l(13,"Tipo de C\xF3digo"),r()(),u(14,M,6,2,"div",5)(15,R,5,1,"div",5)(16,Q,33,5),n(17,"button",10),l(18),r()()()()()),t&2){let f,g,s,a,b;d(4),h("formGroup",i.form),d(10),c(((f=i.form.get("codeType"))==null?null:f.value)==="barcode"?14:-1),d(),c(((g=i.form.get("codeType"))==null?null:g.value)==="pluCode"?15:-1),d(),c((s=i.form.get("pluCode"))!=null&&s.valid&&((s=i.form.get("pluCode"))==null?null:s.value)!=""||(s=i.form.get("barcode"))!=null&&s.valid&&((s=i.form.get("barcode"))==null?null:s.value)!=""?16:-1),d(),h("disabled",i.form.invalid||((a=i.form.get("barcode"))==null?null:a.invalid)&&((a=i.form.get("pluCode"))==null?null:a.invalid)),d(),E(" ",i.form.invalid||(b=i.form.get("barcode"))!=null&&b.invalid&&((b=i.form.get("pluCode"))!=null&&b.invalid)?"Completa los campos":"Crear"," ")}},dependencies:[O,w,V,$,P,F,I,T,k,N,q,S],encapsulation:2})};export{G as CreateProductFormComponent};
