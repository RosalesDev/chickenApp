import{A as f,Aa as M,B as b,Ca as $,E as s,Ea as D,H as n,I as r,J as p,L as x,M as _,S as l,U as E,ea as S,g as h,ja as F,n as C,na as P,oa as T,pa as d,pb as G,qa as w,ra as k,u as a,ua as N,v,wa as L,x as y,xa as I,ya as q,za as V}from"./chunk-NSAICTIU.js";function R(i,e){i&1&&(n(0,"span",13),l(1,"Se requiere el c\xF3digo de barras."),r())}function U(i,e){i&1&&(n(0,"span",13),l(1,"Le faltan digitos al c\xF3dico de barras"),r())}function j(i,e){if(i&1&&(n(0,"div",5),p(1,"input",12),f(2,R,2,0,"span",13)(3,U,2,0,"span",13),n(4,"label",14),l(5,"Escan\xE9a el C\xF3digo de barras"),r()()),i&2){let t,o=_();a(2),s(o.form.get("barcode").hasError("required")?2:-1),a(),s(((t=o.form.get("barcode"))==null||t.value==null?null:t.value.toString().length)<6&&o.form.get("barcode").dirty?3:-1)}}function A(i,e){i&1&&(n(0,"div",17),l(1," El c\xF3digo PLU es debe tener 5 d\xEDgitos. "),r())}function B(i,e){if(i&1&&(n(0,"div",5),p(1,"input",15),n(2,"label",16),l(3,"C\xF3digo PLU"),r(),f(4,A,2,0,"div",17),r()),i&2){let t,o=_();a(4),s((t=o.form.get("pluCode"))!=null&&t.hasError("pattern")&&((t=o.form.get("pluCode"))!=null&&t.touched)?4:-1)}}function W(i,e){i&1&&(n(0,"span",13),l(1,"El nombre es obligatorio."),r())}function K(i,e){i&1&&(n(0,"span",13),l(1,"Campo obligatorio."),r())}function z(i,e){i&1&&(n(0,"span",13),l(1,"El stock es obligatorio"),r())}function H(i,e){i&1&&(n(0,"span",13),l(1,"Este dato es obligatorio."),r())}function J(i,e){i&1&&(n(0,"span",13),l(1,"Este dato es obligatorio."),r())}function Q(i,e){if(i&1&&(n(0,"div",21)(1,"div",5),p(2,"input",31),n(3,"label",32),l(4,"Precio por Kg"),r(),f(5,J,2,0,"span",13),r()()),i&2){let t,o=_(2);a(5),s(o.form.get("price_by_kg").hasError("required")&&((t=o.form.get("price_by_kg"))!=null&&t.touched||(t=o.form.get("price_by_kg"))!=null&&t.dirty)?5:-1)}}function X(i,e){if(i&1&&(n(0,"div",5),p(1,"input",18),n(2,"label",19),l(3,"Nombre"),r(),f(4,W,2,0,"span",13),r(),n(5,"div",20)(6,"div",21)(7,"div",5),p(8,"input",22),n(9,"label",23),l(10,"Iniciales"),r(),f(11,K,2,0,"span",13),r()(),n(12,"div",21)(13,"div",5),p(14,"input",24),n(15,"label",25),l(16,"Stock"),r(),f(17,z,2,0,"span",13),r()()(),p(18,"hr"),n(19,"div",5)(20,"div",26)(21,"label",27),l(22,"Producto pesable"),r(),p(23,"input",28),r()(),n(24,"div",5)(25,"div",20)(26,"div",21)(27,"div",5),p(28,"input",29),n(29,"label",30),l(30,"Precio por Unidad"),r(),f(31,H,2,0,"span",13),r()(),f(32,Q,6,1,"div",21),r()()),i&2){let t,o,m,g,u,c=_();a(4),s(c.form.get("name").hasError("required")&&((t=c.form.get("name"))!=null&&t.touched||(t=c.form.get("name"))!=null&&t.dirty)?4:-1),a(7),s(c.form.get("initials").hasError("required")&&((o=c.form.get("initials"))!=null&&o.touched||(o=c.form.get("initials"))!=null&&o.dirty)?11:-1),a(6),s(c.form.get("availability_in_deposit").hasError("required")&&((m=c.form.get("availability_in_deposit"))!=null&&m.touched||(m=c.form.get("availability_in_deposit"))!=null&&m.dirty)?17:-1),a(14),s(c.form.get("price_by_unit").hasError("required")&&((g=c.form.get("price_by_unit"))!=null&&g.touched||(g=c.form.get("price_by_unit"))!=null&&g.dirty)?31:-1),a(),s((u=c.form.get("is_weighed"))!=null&&u.value?32:-1)}}function Y(i,e){if(i&1&&(n(0,"button",10),p(1,"i",33),l(2," Guardando... "),n(3,"div",34)(4,"span",35),l(5,"Loading..."),r()()()),i&2){let t=_();b("disabled",t.isLoading)}}function Z(i,e){if(i&1&&(n(0,"button",11),l(1),r()),i&2){let t,o,m=_();b("disabled",m.form.invalid||((t=m.form.get("barcode"))==null?null:t.invalid)&&((t=m.form.get("pluCode"))==null?null:t.invalid)),a(),E(" ",m.form.invalid||(o=m.form.get("barcode"))!=null&&o.invalid&&((o=m.form.get("pluCode"))!=null&&o.invalid)?"Completa los campos":"Crear"," ")}}var O=class i{constructor(e){this.router=e;console.log("Se ejecuta el constructor"),this.form=this.fb.group({codeType:["barcode",[d.required]],barcode:["",[d.required,d.minLength(6),d.pattern(/^[0-9]/)]],pluCode:["",[d.required,d.pattern(/^[0-9]{5}$/)]],initials:["",[d.required]],is_weighed:[!1,[d.required]],name:["",[d.required]],availability_in_deposit:["",[d.required,d.pattern(/^(?:0|[1-9]\d*)(?:[.,]\d+)?$/)]],price_by_unit:["",[d.required,d.pattern(/^(?:0|[1-9]\d*)(?:[.,]\d+)?$/)]],price_by_kg:["",[d.required,d.pattern(/^(?:0|[1-9]\d*)(?:[.,]\d+)?$/)]]})}showProductForm=!1;productService=C(G);products=[];fb=C($);form;isLoading=!1;ngOnInit(){console.log("Se ejecuta el ngOnInit"),this.form.get("name")?.valueChanges.subscribe(e=>{this.generarIniciales(e)}),this.form.get("price_by_kg")?.disable(),this.form.get("is_weighed")?.valueChanges.subscribe(e=>{e?this.form.get("price_by_kg")?.enable():(this.form.get("price_by_kg")?.disable(),this.form.get("price_by_kg")?.reset())}),this.form.get("pluCode")?.valueChanges.subscribe(e=>{!/^\d+$/.test(e)&&e?.length>0&&this.form.get("pluCode")?.setValue(e.slice(0,e.length-1)),e?.length>5&&this.form.get("pluCode")?.setValue(e.slice(0,5))}),this.form.get("barcode")?.valueChanges.subscribe(e=>{!/^\d+$/.test(e)&&e?.length>0&&this.form.get("barcode")?.setValue(e.slice(0,e.length-1))}),this.form.get("availability_in_deposit")?.valueChanges.subscribe(e=>{!/^(?:0|[1-9]\d*)(?:[.,]\d*)?$/.test(e)&&e?.length>0&&this.form.get("availability_in_deposit")?.setValue(e.slice(0,e.length-1))}),this.form.get("price_by_unit")?.valueChanges.subscribe(e=>{!/^(?:0|[1-9]\d*)(?:[.,]\d*)?$/.test(e)&&e?.length>0&&this.form.get("price_by_unit")?.setValue(e.slice(0,e?.length-1))}),this.form.get("price_by_kg")?.valueChanges.subscribe(e=>{!/^(?:0|[1-9]\d*)(?:[.,]\d*)?$/.test(e)&&e?.length>0&&this.form.get("price_by_kg")?.setValue(e.slice(0,e?.length-1))}),this.form.get("pluCode")?.disable(),this.form.get("codeType")?.valueChanges.subscribe(e=>{this.form.get("name")?.reset(),this.form.get("availability_in_deposit")?.reset(),this.form.get("price_by_unit")?.reset(),this.form.get("price_by_kg")?.reset(),e==="pluCode"?(this.form.get("barcode")?.reset(),this.form.get("barcode")?.disable(),this.form.get("pluCode")?.disabled&&this.form.get("pluCode")?.enable()):(this.form.get("pluCode")?.reset(),this.form.get("pluCode")?.disable(),this.form.get("barcode")?.disabled&&this.form.get("barcode")?.enable())})}generarIniciales(e){if(!e){this.form.patchValue({initials:""});return}let t=e.split(/\s+/).map(o=>o[0]?.toUpperCase()||"").join("");this.form.patchValue({initials:t})}logInvalidFields(){Object.keys(this.form.controls).forEach(e=>{let t=this.form.get(e);t?.invalid&&console.log(`El campo "${e}" es inv\xE1lido. Errores:`,t.errors)})}createProduct(){return h(this,null,function*(){if(this.isLoading=!0,this.showLoadingModal(),this.form.invalid){this.logInvalidFields(),alert("Formulario inv\xE1lido");return}yield this.productService.saveProduct(this.productService.mapProductFormToProduct(this.form)),this.isLoading=!1,this.hideModal(),this.router.navigate(["/home/products"])})}showLoadingModal(){let e=document.getElementById("loadingModal");e&&(e.classList.add("show"),e.style.display="block",document.body.classList.add("modal-open"))}hideModal(){let e=document.getElementById("loadingModal");e&&(e.classList.remove("show"),e.style.display="none",document.body.classList.remove("modal-open"))}closeProductForm(){this.showProductForm=!1}static \u0275fac=function(t){return new(t||i)(v(F))};static \u0275cmp=y({type:i,selectors:[["app-create-product-form"]],inputs:{showProductForm:"showProductForm"},decls:19,vars:5,consts:[[1,"card","mt-5","shadow","w-50","m-auto"],[1,"card-header","text-center","fs-5","fw-bold"],[1,"card-body"],[1,"needs-validation",3,"ngSubmit","formGroup"],[1,"container"],[1,"form-floating","mb-3"],["id","codeType","formControlName","codeType",1,"form-select"],["value","barcode"],["value","pluCode"],["for","codeType"],[1,"btn","btn-info","w-100",3,"disabled"],["type","submit",1,"btn","btn-primary","w-100",3,"disabled"],["autofocus","","type","text","id","barcode","autocomplete","off","placeholder","Escan\xE9a el C\xF3digo de barras","formControlName","barcode",1,"form-control"],[1,"alert-danger"],["for","barcode"],["id","plu_code","type","text","autofocus","","autocomplete","off","placeholder","Ingresa el C\xF3digo PLU","formControlName","pluCode",1,"form-control"],["for","plu_code"],[1,"text-danger","mt-1"],["type","text","id","name","autocomplete","off","placeholder","Nombre del producto","formControlName","name",1,"form-control","text-uppercase"],["for","name"],[1,"row"],[1,"col-6"],["type","text","id","initials","autocomplete","off","placeholder","Iniciales","formControlName","initials",1,"form-control"],["for","initials"],["type","text","autocomplete","off","id","availability_in_deposit","formControlName","availability_in_deposit",1,"form-control"],["for","availability_in_deposit",1,"form-label"],[1,"d-flex","form-switch","ps-0"],["for","flexSwitchIsWighed",1,"form-check-label"],["type","checkbox","role","switch","id","flexSwitchIsWighed","formControlName","is_weighed",1,"form-check-input","ms-3"],["type","currency","autocomplete","off","id","price_by_unit","formControlName","price_by_unit",1,"form-control"],["for","price_by_unit",1,"form-label"],["type","currency","autocomplete","off","id","price_by_kg","formControlName","price_by_kg",1,"form-control"],["for","price_by_kg",1,"form-label"],[1,"bi","bi-floppy"],["role","status",1,"spinner-border","spinner-border-sm"],[1,"visually-hidden"]],template:function(t,o){if(t&1&&(n(0,"div",0)(1,"div",1),l(2,"CREAR PRODUCTO"),r(),n(3,"div",2)(4,"form",3),x("ngSubmit",function(){return o.createProduct()}),n(5,"div",4)(6,"div",5)(7,"select",6)(8,"option",7),l(9,"C\xF3digo de Barras"),r(),n(10,"option",8),l(11,"C\xF3digo PLU"),r()(),n(12,"label",9),l(13,"Tipo de C\xF3digo"),r()(),f(14,j,6,2,"div",5)(15,B,5,1,"div",5)(16,X,33,5)(17,Y,6,1,"button",10)(18,Z,2,2,"button",11),r()()()()),t&2){let m,g,u;a(4),b("formGroup",o.form),a(10),s(((m=o.form.get("codeType"))==null?null:m.value)==="barcode"?14:-1),a(),s(((g=o.form.get("codeType"))==null?null:g.value)==="pluCode"?15:-1),a(),s((u=o.form.get("pluCode"))!=null&&u.valid&&((u=o.form.get("pluCode"))==null?null:u.value)!=""||(u=o.form.get("barcode"))!=null&&u.valid&&((u=o.form.get("barcode"))==null?null:u.value)!=""?16:-1),a(),s(o.isLoading?17:18)}},dependencies:[D,N,V,M,T,P,q,w,k,L,I,S],encapsulation:2})};export{O as CreateProductFormComponent};
